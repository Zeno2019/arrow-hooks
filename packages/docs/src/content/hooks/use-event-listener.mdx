---
title: useEventListener
description: 用于处理类型安全的 DOM 事件监听器的 React Hook
---

import { EventListenerExample } from '@/components/examples';

# useEventListener

用于处理类型安全的 DOM 事件监听器的 React Hook，提供简洁的 API 来监听全局事件或特定元素事件，自动处理事件清理和性能优化。

## 在线演示

<EventListenerExample />

## 基本用法

```tsx tab="React 函数组件"
import { useEventListener } from 'arrow-hooks'

function App() {
  const handleClick = (event: MouseEvent) => {
    console.log('全局点击事件:', event)
  }

  // 监听全局点击事件
  useEventListener('click', handleClick)

  return <div>点击页面任意位置查看控制台</div>
}
```

## 使用场景

### 1. 全局事件监听

监听窗口级别的事件，如键盘、鼠标、滚动等：

```tsx
import { useEventListener } from 'arrow-hooks'
import { useState } from 'react'

function GlobalEventExample() {
  const [scrollY, setScrollY] = useState(0)
  const [lastKey, setLastKey] = useState('')

  // 监听全局滚动
  useEventListener('scroll', (e: Event) => {
    setScrollY(window.scrollY)
  })

  // 监听键盘事件
  useEventListener('keydown', (e: KeyboardEvent) => {
    setLastKey(e.key)
  })

  return (
    <div>
      <p>滚动位置: {scrollY}px</p>
      <p>最后按键: {lastKey}</p>
    </div>
  )
}
```

### 2. 特定元素事件监听

监听特定 DOM 元素的事件：

```tsx
import { useEventListener } from 'arrow-hooks'
import { useRef, useState } from 'react'

function ElementEventExample() {
  const buttonRef = useRef<HTMLButtonElement>(null)
  const [count, setCount] = useState(0)

  // 监听特定按钮的点击事件
  useEventListener(
    'click',
    () => setCount(prev => prev + 1),
    buttonRef.current
  )

  return (
    <div>
      <button ref={buttonRef}>
        点击计数器: {count}
      </button>
    </div>
  )
}
```

### 3. 文档事件监听

监听 document 级别的事件：

```tsx
import { useEventListener } from 'arrow-hooks'
import { useState } from 'react'

function DocumentEventExample() {
  const [isVisible, setIsVisible] = useState(true)

  // 监听页面可见性变化
  useEventListener(
    'visibilitychange',
    () => {
      setIsVisible(!document.hidden)
    },
    document
  )

  return (
    <div>
      <p>页面状态: {isVisible ? '可见' : '隐藏'}</p>
      <p>切换到其他标签页试试</p>
    </div>
  )
}
```

### 4. 复杂交互事件

结合多个事件实现复杂交互：

```tsx
import { useEventListener } from 'arrow-hooks'
import { useState, useRef } from 'react'

function ComplexInteractionExample() {
  const [isDragging, setIsDragging] = useState(false)
  const [position, setPosition] = useState({ x: 0, y: 0 })
  const elementRef = useRef<HTMLDivElement>(null)

  // 鼠标按下开始拖拽
  useEventListener(
    'mousedown',
    () => setIsDragging(true),
    elementRef.current
  )

  // 鼠标移动时更新位置
  useEventListener('mousemove', (e: MouseEvent) => {
    if (isDragging) {
      setPosition({ x: e.clientX, y: e.clientY })
    }
  })

  // 鼠标抬起结束拖拽
  useEventListener('mouseup', () => setIsDragging(false))

  return (
    <div>
      <div
        ref={elementRef}
        style={{
          width: '100px',
          height: '100px',
          backgroundColor: isDragging ? '#ff4757' : '#2ed573',
          cursor: 'grab',
          borderRadius: '4px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          color: 'white',
          userSelect: 'none'
        }}
      >
        {isDragging ? '拖拽中' : '拖拽我'}
      </div>
      <p>鼠标位置: ({position.x}, {position.y})</p>
    </div>
  )
}
```

## API 参考

### 参数

| 参数 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| eventType | keyof EventMap | - | 要监听的事件类型 |
| handler | (event: EventMap[K]) => void | - | 事件处理函数 |
| element | ElementType | window | 绑定事件的元素 |

### 返回值

无返回值（void）

### 类型定义

```tsx
type EventMap = WindowEventMap & DocumentEventMap & HTMLElementEventMap
type EventType = keyof EventMap
type ElementType = Window | Document | HTMLElement

function useEventListener<K extends EventType>(
  eventType: K,
  handler: (event: EventMap[K]) => void,
  element?: ElementType
): void
```

### 支持的事件类型

useEventListener 支持所有标准的 DOM 事件：

**鼠标事件:**
- `click`, `dblclick`, `mousedown`, `mouseup`
- `mousemove`, `mouseenter`, `mouseleave`
- `mouseover`, `mouseout`, `contextmenu`

**键盘事件:**
- `keydown`, `keyup`, `keypress`

**窗口事件:**
- `resize`, `scroll`, `load`, `unload`
- `beforeunload`, `focus`, `blur`

**表单事件:**
- `submit`, `change`, `input`, `focus`, `blur`

**触摸事件:**
- `touchstart`, `touchend`, `touchmove`, `touchcancel`

**其他事件:**
- `visibilitychange`, `online`, `offline`

## 注意事项

- **自动清理**: 组件卸载时会自动移除事件监听器，无需手动清理
- **性能优化**: 使用 useRef 保存处理函数引用，避免不必要的重新绑定
- **类型安全**: 完整的 TypeScript 支持，事件类型会根据 eventType 自动推断
- **SSR 兼容**: 在服务端渲染环境下会自动跳过事件绑定
- **元素检查**: 会检查目标元素是否支持 addEventListener
- **函数引用**: handler 函数变化时会自动更新事件监听器的回调