---
title: useEventListener
description: ç”¨äºå¤„ç†ç±»å‹å®‰å…¨çš„ DOM äº‹ä»¶ç›‘å¬å™¨çš„ React Hook
---

import { EventListenerExample } from '@/components/examples';

# useEventListener

ç”¨äºå¤„ç†ç±»å‹å®‰å…¨çš„ DOM äº‹ä»¶ç›‘å¬å™¨çš„ React Hookï¼Œæä¾›ç®€æ´çš„ API æ¥ç›‘å¬å…¨å±€äº‹ä»¶æˆ–ç‰¹å®šå…ƒç´ äº‹ä»¶ï¼Œè‡ªåŠ¨å¤„ç†äº‹ä»¶æ¸…ç†å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

## åœ¨çº¿æ¼”ç¤º

<EventListenerExample />

## åŸºæœ¬ç”¨æ³•

```tsx tab="React å‡½æ•°ç»„ä»¶"
import { useEventListener } from 'arrow-hooks'
import { useRef, useState } from 'react'

function App() {
  const [coordinates, setCoordinates] = useState({ x: 0, y: 0 })
  const [clicks, setClicks] = useState(0)
  const [keyPresses, setKeyPresses] = useState<string[]>([])
  const buttonRef = useRef<HTMLButtonElement>(null)

  // ç›‘å¬å…¨å±€é¼ æ ‡ç§»åŠ¨
  useEventListener('mousemove', (e: MouseEvent) => {
    setCoordinates({ x: e.clientX, y: e.clientY })
  })

  // ç›‘å¬æŒ‰é’®ç‚¹å‡»
  useEventListener('click', () => {
    setClicks(prev => prev + 1)
  }, buttonRef.current ?? undefined)

  // ç›‘å¬é”®ç›˜æŒ‰é”®
  useEventListener('keydown', (e: KeyboardEvent) => {
    if (e.key === 'Escape') {
      setKeyPresses([])
    } else {
      setKeyPresses(prev => [...prev.slice(-4), e.key])
    }
  })

  return (
    <div style={{ padding: '1rem' }}>
      {/* é¼ æ ‡ä½ç½®è·Ÿè¸ª */}
      <div style={{ marginBottom: '1.5rem' }}>
        <h4>ğŸ–¡ï¸ é¼ æ ‡ä½ç½®è·Ÿè¸ª</h4>
        <div style={{
          padding: '0.5rem',
          backgroundColor: '#f5f5f5',
          borderRadius: '4px',
          fontFamily: 'monospace'
        }}>
          X: {coordinates.x}px, Y: {coordinates.y}px
        </div>
        <p style={{ fontSize: '0.9rem', color: '#666', margin: '0.5rem 0 0 0' }}>
          ç§»åŠ¨é¼ æ ‡æŸ¥çœ‹åæ ‡å˜åŒ–
        </p>
      </div>

      {/* å…ƒç´ ç‚¹å‡»äº‹ä»¶ */}
      <div style={{ marginBottom: '1.5rem' }}>
        <h4>ğŸ‘† å…ƒç´ ç‚¹å‡»äº‹ä»¶</h4>
        <button
          ref={buttonRef}
          style={{
            padding: '0.5rem 1rem',
            fontSize: '1rem',
            backgroundColor: '#1890ff',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer'
          }}
        >
          ç‚¹å‡»æˆ‘ ({clicks} æ¬¡)
        </button>
      </div>

      {/* é”®ç›˜äº‹ä»¶ */}
      <div>
        <h4>âŒ¨ï¸ é”®ç›˜äº‹ä»¶</h4>
        <div style={{
          padding: '0.5rem',
          backgroundColor: '#f0f8ff',
          border: '1px dashed #1890ff',
          borderRadius: '4px',
          minHeight: '2rem',
          fontFamily: 'monospace'
        }}>
          æœ€è¿‘æŒ‰é”®: {keyPresses.join(' â†’ ') || 'æœªæ£€æµ‹åˆ°æŒ‰é”®'}
        </div>
        <p style={{ fontSize: '0.9rem', color: '#666', margin: '0.5rem 0 0 0' }}>
          æŒ‰ä»»æ„é”®æŸ¥çœ‹æ•ˆæœï¼ŒæŒ‰ ESC æ¸…é™¤è®°å½•
        </p>
      </div>
    </div>
  )
}
```

## å…¶ä»–åœºæ™¯

### 1. å…¨å±€äº‹ä»¶ç›‘å¬

ç›‘å¬çª—å£çº§åˆ«çš„äº‹ä»¶ï¼Œå¦‚é”®ç›˜ã€é¼ æ ‡ã€æ»šåŠ¨ç­‰ï¼š

```tsx
import { useEventListener } from 'arrow-hooks'
import { useState } from 'react'

function GlobalEventExample() {
  const [scrollY, setScrollY] = useState(0)
  const [lastKey, setLastKey] = useState('')

  // ç›‘å¬å…¨å±€æ»šåŠ¨
  useEventListener('scroll', (e: Event) => {
    setScrollY(window.scrollY)
  })

  // ç›‘å¬é”®ç›˜äº‹ä»¶
  useEventListener('keydown', (e: KeyboardEvent) => {
    setLastKey(e.key)
  })

  return (
    <div>
      <p>æ»šåŠ¨ä½ç½®: {scrollY}px</p>
      <p>æœ€åæŒ‰é”®: {lastKey}</p>
    </div>
  )
}
```

### 2. ç‰¹å®šå…ƒç´ äº‹ä»¶ç›‘å¬

ç›‘å¬ç‰¹å®š DOM å…ƒç´ çš„äº‹ä»¶ï¼š

```tsx
import { useEventListener } from 'arrow-hooks'
import { useRef, useState } from 'react'

function ElementEventExample() {
  const buttonRef = useRef<HTMLButtonElement>(null)
  const [count, setCount] = useState(0)

  // ç›‘å¬ç‰¹å®šæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
  useEventListener(
    'click',
    () => setCount(prev => prev + 1),
    buttonRef.current
  )

  return (
    <div>
      <button ref={buttonRef}>
        ç‚¹å‡»è®¡æ•°å™¨: {count}
      </button>
    </div>
  )
}
```

### 3. æ–‡æ¡£äº‹ä»¶ç›‘å¬

ç›‘å¬ document çº§åˆ«çš„äº‹ä»¶ï¼š

```tsx
import { useEventListener } from 'arrow-hooks'
import { useState } from 'react'

function DocumentEventExample() {
  const [isVisible, setIsVisible] = useState(true)

  // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
  useEventListener(
    'visibilitychange',
    () => {
      setIsVisible(!document.hidden)
    },
    document
  )

  return (
    <div>
      <p>é¡µé¢çŠ¶æ€: {isVisible ? 'å¯è§' : 'éšè—'}</p>
      <p>åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µè¯•è¯•</p>
    </div>
  )
}
```

### 4. å¤æ‚äº¤äº’äº‹ä»¶

ç»“åˆå¤šä¸ªäº‹ä»¶å®ç°å¤æ‚äº¤äº’ï¼š

```tsx
import { useEventListener } from 'arrow-hooks'
import { useState, useRef } from 'react'

function ComplexInteractionExample() {
  const [isDragging, setIsDragging] = useState(false)
  const [position, setPosition] = useState({ x: 0, y: 0 })
  const elementRef = useRef<HTMLDivElement>(null)

  // é¼ æ ‡æŒ‰ä¸‹å¼€å§‹æ‹–æ‹½
  useEventListener(
    'mousedown',
    () => setIsDragging(true),
    elementRef.current
  )

  // é¼ æ ‡ç§»åŠ¨æ—¶æ›´æ–°ä½ç½®
  useEventListener('mousemove', (e: MouseEvent) => {
    if (isDragging) {
      setPosition({ x: e.clientX, y: e.clientY })
    }
  })

  // é¼ æ ‡æŠ¬èµ·ç»“æŸæ‹–æ‹½
  useEventListener('mouseup', () => setIsDragging(false))

  return (
    <div>
      <div
        ref={elementRef}
        style={{
          width: '100px',
          height: '100px',
          backgroundColor: isDragging ? '#ff4757' : '#2ed573',
          cursor: 'grab',
          borderRadius: '4px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          color: 'white',
          userSelect: 'none'
        }}
      >
        {isDragging ? 'æ‹–æ‹½ä¸­' : 'æ‹–æ‹½æˆ‘'}
      </div>
      <p>é¼ æ ‡ä½ç½®: ({position.x}, {position.y})</p>
    </div>
  )
}
```

## API å‚è€ƒ

### å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|--------|------|
| eventType | keyof EventMap | - | è¦ç›‘å¬çš„äº‹ä»¶ç±»å‹ |
| handler | (event: EventMap[K]) => void | - | äº‹ä»¶å¤„ç†å‡½æ•° |
| element | ElementType | window | ç»‘å®šäº‹ä»¶çš„å…ƒç´  |

### è¿”å›å€¼

æ— è¿”å›å€¼ï¼ˆvoidï¼‰

### ç±»å‹å®šä¹‰

```tsx
type EventMap = WindowEventMap & DocumentEventMap & HTMLElementEventMap
type EventType = keyof EventMap
type ElementType = Window | Document | HTMLElement

function useEventListener<K extends EventType>(
  eventType: K,
  handler: (event: EventMap[K]) => void,
  element?: ElementType
): void
```

### æ”¯æŒçš„äº‹ä»¶ç±»å‹

useEventListener æ”¯æŒæ‰€æœ‰æ ‡å‡†çš„ DOM äº‹ä»¶ï¼š

**é¼ æ ‡äº‹ä»¶:**
- `click`, `dblclick`, `mousedown`, `mouseup`
- `mousemove`, `mouseenter`, `mouseleave`
- `mouseover`, `mouseout`, `contextmenu`

**é”®ç›˜äº‹ä»¶:**
- `keydown`, `keyup`, `keypress`

**çª—å£äº‹ä»¶:**
- `resize`, `scroll`, `load`, `unload`
- `beforeunload`, `focus`, `blur`

**è¡¨å•äº‹ä»¶:**
- `submit`, `change`, `input`, `focus`, `blur`

**è§¦æ‘¸äº‹ä»¶:**
- `touchstart`, `touchend`, `touchmove`, `touchcancel`

**å…¶ä»–äº‹ä»¶:**
- `visibilitychange`, `online`, `offline`

## æ³¨æ„äº‹é¡¹

- **è‡ªåŠ¨æ¸…ç†**: ç»„ä»¶å¸è½½æ—¶ä¼šè‡ªåŠ¨ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œæ— éœ€æ‰‹åŠ¨æ¸…ç†
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ useRef ä¿å­˜å¤„ç†å‡½æ•°å¼•ç”¨ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°ç»‘å®š
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒï¼Œäº‹ä»¶ç±»å‹ä¼šæ ¹æ® eventType è‡ªåŠ¨æ¨æ–­
- **SSR å…¼å®¹**: åœ¨æœåŠ¡ç«¯æ¸²æŸ“ç¯å¢ƒä¸‹ä¼šè‡ªåŠ¨è·³è¿‡äº‹ä»¶ç»‘å®š
- **å…ƒç´ æ£€æŸ¥**: ä¼šæ£€æŸ¥ç›®æ ‡å…ƒç´ æ˜¯å¦æ”¯æŒ addEventListener
- **å‡½æ•°å¼•ç”¨**: handler å‡½æ•°å˜åŒ–æ—¶ä¼šè‡ªåŠ¨æ›´æ–°äº‹ä»¶ç›‘å¬å™¨çš„å›è°ƒ